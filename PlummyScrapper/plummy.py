#!/usr/bin/env python3
"""
PlummyScraper - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –æ–±–æ–ª–æ—á–∫–∞
–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É –∏ –≤–≤–æ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
"""
import cmd
import sys
import os
from pathlib import Path
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env
load_dotenv()

# –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—É—Ç—å
sys.path.insert(0, str(Path(__file__).parent))

from commands import articles, fetch, update, sync, manage, reports, utils as cmd_utils, expand, restore, fix_single_size, fix_images, sync_prices_full


class PlummyShell(cmd.Cmd):
    """–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –æ–±–æ–ª–æ—á–∫–∞ PlummyScraper"""
    
    intro = """
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    PlummyScraper v2.0                          ‚ïë
‚ïë           –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏                    ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

–í–≤–µ–¥–∏—Ç–µ 'help' –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥ –∏–ª–∏ 'help <–∫–æ–º–∞–Ω–¥–∞>' –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏
–í–≤–µ–¥–∏—Ç–µ 'exit' –∏–ª–∏ 'quit' –¥–ª—è –≤—ã—Ö–æ–¥–∞

"""
    prompt = '\nüî• plummy> '
    
    def __init__(self):
        super().__init__()
        self.ruler = '‚îÄ'
        self.pending_links = []  # –ë—É—Ñ–µ—Ä –¥–ª—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫
    
    # ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ê–†–¢–ò–ö–£–õ–ê–ú–ò ====================
    
    def do_add_articles(self, arg):
        """
        –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã –Ω–∞–ø—Ä—è–º—É—é –≤ –ë–î –∏–∑ —Å—Å—ã–ª–æ–∫ Dewu.
        
        –ß–¢–û –î–ï–õ–ê–ï–¢:
        - –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Å—Å—ã–ª–∫–∏ Dewu –≤ SPU/SKU ID
        - –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
        - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ API (—Å rate limit 0.5 req/sec)
        - –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ —Ä–∞–∑–º–µ—Ä–∞–º (–¥–ª—è –æ–±—É–≤–∏)
        - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–≤–∞—Ä—ã –≤ –ë–î
        - –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã (–µ—Å–ª–∏ SPU+SKU —É–∂–µ –µ—Å—Ç—å –≤ –ë–î)
        
        –°–ü–û–°–û–ë–´ –î–û–ë–ê–í–õ–ï–ù–ò–Ø –°–°–´–õ–û–ö:
        
        –°–ø–æ—Å–æ–± 1: –í—Å—Ç–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Å—ã–ª–æ–∫ (–¥–∞–∂–µ —Å –ø–µ—Ä–µ–Ω–æ—Å–∞–º–∏ —Å—Ç—Ä–æ–∫!)
          add-articles https://dw4.co/t/A/1a
          https://dw4.co/t/A/2b
          https://dw4.co/t/A/3c
          (–Ω–∞–∂–º–∏—Ç–µ Enter –Ω–∞ –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏)
          
        –°–ø–æ—Å–æ–± 2: –í—Å–µ —Å—Å—ã–ª–∫–∏ –≤ –û–î–ù–û–ô —Å—Ç—Ä–æ–∫–µ —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª
          add-articles https://dw4.co/t/A/1a https://dw4.co/t/A/2b
          
        –°–ø–æ—Å–æ–± 3: –ë–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
          add-articles
          (–∑–∞—Ç–µ–º –≤—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫–∏)
          (–Ω–∞–∂–º–∏—Ç–µ Enter –Ω–∞ –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–µ)
        
        –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø:
        - –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è (–Ω–µ—Ç —Ü–µ–Ω, –æ—à–∏–±–∫–∞ API) - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫
        - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SKU-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        - –¶–µ–Ω—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ —Ñ–æ—Ä–º—É–ª–∞–º –∏–∑ price_formulas.json
        """
        links = []
        
        # –ï—Å–ª–∏ –∞—Ä–≥—É–º–µ–Ω—Ç –ø–µ—Ä–µ–¥–∞–Ω –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
        if arg.strip():
            # –†–∞–∑–±–∏–≤–∞–µ–º –ø–æ –ø—Ä–æ–±–µ–ª–∞–º –∏ –ø–µ—Ä–µ–Ω–æ—Å–∞–º —Å—Ç—Ä–æ–∫
            potential_links = [link.strip() for link in arg.replace('\n', ' ').split() if link.strip()]
            
            # –§–∏–ª—å—Ç—Ä—É–µ–º –≤–∞–ª–∏–¥–Ω—ã–µ —Å—Å—ã–ª–∫–∏
            for link in potential_links:
                if link.startswith('http://') or link.startswith('https://'):
                    links.append(link)
                    # –¢–∞–∫–∂–µ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –±—É—Ñ–µ—Ä –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —Å—Ç—Ä–æ–∫
                    if link not in self.pending_links:
                        self.pending_links.append(link)
                else:
                    print(f"‚ö†Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω–æ: {link} (–Ω–µ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Å—Å—ã–ª–∫—É)")
            
            # –ï—Å–ª–∏ –µ—Å—Ç—å —Å—Å—ã–ª–∫–∏ –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–µ, –≤—ã–≤–æ–¥–∏–º –ø–æ–¥—Å–∫–∞–∑–∫—É
            if links:
                print(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(links)} —Å—Å—ã–ª–æ–∫ –∏–∑ –∫–æ–º–∞–Ω–¥—ã")
                print("üí° –í—Å—Ç–∞–≤—å—Ç–µ –µ—â–µ —Å—Å—ã–ª–∫–∏ (–∫–∞–∂–¥–∞—è –Ω–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–µ) –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
                return  # –ñ–¥–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –∏–ª–∏ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
        else:
            # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º: —á–∏—Ç–∞–µ–º –ø–æ—Å—Ç—Ä–æ—á–Ω–æ
            print("\nüìù –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–´–ô –†–ï–ñ–ò–ú")
            print("‚îÄ" * 60)
            print("–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫–∏ (–º–æ–∂–Ω–æ –≤—Å–µ —Å—Ä–∞–∑—É –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞)")
            print("–ù–∞–∂–º–∏—Ç–µ Enter –Ω–∞ –ü–£–°–¢–û–ô —Å—Ç—Ä–æ–∫–µ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è")
            print("‚îÄ" * 60)
            print()
            
            while True:
                try:
                    line = input("   ").strip()
                    if not line:
                        break
                    # –†–∞–∑–±–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É –ø–æ –ø—Ä–æ–±–µ–ª–∞–º (–µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Å—ã–ª–æ–∫ –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ)
                    for link in line.split():
                        link = link.strip()
                        if link and (link.startswith('http://') or link.startswith('https://')):
                            links.append(link)
                        elif link:
                            print(f"   ‚ö†Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω–æ: {link} (–Ω–µ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Å—Å—ã–ª–∫—É)")
                except EOFError:
                    break
                except KeyboardInterrupt:
                    print("\n‚ö†Ô∏è  –í–≤–æ–¥ –ø—Ä–µ—Ä–≤–∞–Ω")
                    return
        
        if not links:
            print("\n‚ùå –ù–µ —É–∫–∞–∑–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π –≤–∞–ª–∏–¥–Ω–æ–π —Å—Å—ã–ª–∫–∏")
            print("üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: add-articles (–±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤) –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞")
            return
        
        # –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã, —Å–æ—Ö—Ä–∞–Ω—è—è –ø–æ—Ä—è–¥–æ–∫
        unique_links = []
        seen = set()
        for link in links:
            if link not in seen:
                unique_links.append(link)
                seen.add(link)
        
        if len(unique_links) < len(links):
            print(f"‚ÑπÔ∏è  –£–¥–∞–ª–µ–Ω–æ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤: {len(links) - len(unique_links)}")
        
        print(f"\n‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(unique_links)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫\n")
        
        try:
            # –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä—ã –Ω–∞–ø—Ä—è–º—É—é –≤ –ë–î (–Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è add_articles)
            from commands.articles import add_articles_new
            add_articles_new(tuple(unique_links))
            
            # –û—á–∏—â–∞–µ–º –±—É—Ñ–µ—Ä –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
            self.pending_links = []
        except KeyboardInterrupt:
            print("\n‚ö†Ô∏è  –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
            import traceback
            traceback.print_exc()
    
    def do_remove_articles(self, arg):
        """
        –£–¥–∞–ª—è–µ—Ç —Ç–æ–≤–∞—Ä—ã –∏–∑ –ë–î –∏ —Å —Å–∞–π—Ç–∞.
        
        –ß–¢–û –î–ï–õ–ê–ï–¢:
        - –£–¥–∞–ª—è–µ—Ç —Ç–æ–≤–∞—Ä –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        - –£–¥–∞–ª—è–µ—Ç —Ç–æ–≤–∞—Ä —Å WordPress —Å–∞–π—Ç–∞
        - –£–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –∏–∑ sync_log
        - –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–æ–≤–∞—Ä–∞
        
        –ü–û–î–î–ï–†–ñ–ò–í–ê–ï–¢:
        - DB ID (ID —Ç–æ–≤–∞—Ä–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö)
        - WP ID (ID —Ç–æ–≤–∞—Ä–∞ –Ω–∞ WordPress —Å–∞–π—Ç–µ)
        - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ ID
        
        –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
          remove-articles <id1>,<id2>,<id3>
        
        –ü–†–ò–ú–ï–†–´:
          remove-articles 5,7,12        # –ü–æ DB ID
          remove-articles 162040,162028 # –ü–æ WP ID
          remove-articles 5             # –û–¥–∏–Ω —Ç–æ–≤–∞—Ä
        
        –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø:
        - ID —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
        - –ö–æ–º–∞–Ω–¥–∞ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–∞ - –±—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã
        - –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ DB ID, –∏—â–µ—Ç—Å—è –ø–æ WP ID
        - –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏ –∏–∑ –ë–î –∏ —Å —Å–∞–π—Ç–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
        """
        if not arg:
            print("‚ùå –£–∫–∞–∂–∏—Ç–µ ID –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è")
            return
        
        try:
            articles.remove_articles(arg)
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    
    def do_load_data(self, arg):
        """
        –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤-–∑–∞–≥–ª—É—à–µ–∫ –≤ –ë–î.
        
        –ß–¢–û –î–ï–õ–ê–ï–¢:
        - –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –≤ –ë–î —Å data_loaded=False (–∑–∞–≥–ª—É—à–∫–∏)
        - –î–ª—è –∫–∞–∂–¥–æ–π –∑–∞–≥–ª—É—à–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ API
        - –û–±–Ω–æ–≤–ª—è–µ—Ç –ë–î —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
        - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–æ—Ä–º—É–ª—ã —Ü–µ–Ω –∏–∑ price_formulas.json
        
        –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
          load-data
        
        –ö–û–ì–î–ê –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨:
        - –ü–æ—Å–ª–µ add-articles, –µ—Å–ª–∏ —á–∞—Å—Ç—å —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å
        - –î–ª—è –¥–æ–∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –æ—à–∏–±–æ–∫ API
        - –î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–µ—Ä–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        
        –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø:
        - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞–≥–ª—É—à–∫–∏ (data_loaded=False)
        - –£—á–∏—Ç—ã–≤–∞–µ—Ç rate limit 0.5 req/sec
        - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SKU-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        - –°–æ–∑–¥–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –ª–æ–≥-—Ñ–∞–π–ª –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –æ—à–∏–±–æ–∫
        """
        try:
            articles.load_data()
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    
    # ==================== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ë–î ====================
    
    def do_update_db(self, arg):
        """
        –û–±–Ω–æ–≤–ª—è–µ—Ç –í–°–ï —Ç–æ–≤–∞—Ä—ã –≤ –ë–î –∏–∑ API Dewu (–ø–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ).
        
        –ß–¢–û –î–ï–õ–ê–ï–¢:
        - –ë–µ—Ä–µ—Ç –í–°–ï —Ç–æ–≤–∞—Ä—ã –∏–∑ –ë–î (—Å data_loaded=True)
        - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API Dewu
        - –û–±–Ω–æ–≤–ª—è–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Ä–∞–∑–º–µ—Ä—ã, —Ü–µ–Ω—ã, –æ–ø–∏—Å–∞–Ω–∏—è
        - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–æ—Ä–º—É–ª—ã —Ü–µ–Ω –∏–∑ price_formulas.json
        
        –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
          update-db
        
        –ö–û–ì–î–ê –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨:
        - –î–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –≤ –¥–∞–Ω–Ω—ã—Ö
        - –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π/—Ä–∞–∑–º–µ—Ä–æ–≤
        - –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ–≤–∞—Ä–∞—Ö
        
        –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø:
        - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç ~2 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ —Ç–æ–≤–∞—Ä (rate limit 0.5 req/sec)
        - –î–ª—è 100 —Ç–æ–≤–∞—Ä–æ–≤ = ~3-4 –º–∏–Ω—É—Ç—ã
        - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SKU-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        - –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ü–µ–Ω—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∏ —Å—Ä–æ–∫–∞–º –¥–æ—Å—Ç–∞–≤–∫–∏
        - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å –æ—à–∏–±–∫–∞–º–∏ –≤ –∫–æ–Ω—Ü–µ
        """
        try:
            update.update_db()
        except KeyboardInterrupt:
            print("\n‚ö†Ô∏è  –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    
    def do_update_prices_db(self, arg):
        """
        –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ü–µ–Ω—ã –≤ –ë–î (–±—ã—Å—Ç—Ä–µ–µ —á–µ–º update-db).
        
        –ß–¢–û –î–ï–õ–ê–ï–¢:
        - –ë–µ—Ä–µ—Ç –í–°–ï —Ç–æ–≤–∞—Ä—ã –∏–∑ –ë–î (—Å data_loaded=True)
        - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ü–µ–Ω—ã –∏ –Ω–∞–ª–∏—á–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤
        - –ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –æ–ø–∏—Å–∞–Ω–∏—è –∏ –ø—Ä–æ—á–∏–µ –¥–∞–Ω–Ω—ã–µ
        - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–æ—Ä–º—É–ª—ã —Ü–µ–Ω –∏–∑ price_formulas.json
        - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã
        - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ —Ä–∞–∑–º–µ—Ä—ã
        
        –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
          update-prices-db
        
        –ö–û–ì–î–ê –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨:
        - –î–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω –∏ –Ω–∞–ª–∏—á–∏—è
        - –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –æ–±–Ω–æ–≤–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–æ–≤
        - –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—É–ª —Ü–µ–Ω –≤ price_formulas.json
        
        –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø:
        - –ë—ã—Å—Ç—Ä–µ–µ —á–µ–º update-db (–Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é)
        - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç ~2 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ —Ç–æ–≤–∞—Ä (rate limit 0.5 req/sec)
        - –î–ª—è 100 —Ç–æ–≤–∞—Ä–æ–≤ = ~3-4 –º–∏–Ω—É—Ç—ã
        - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É: –æ–±–Ω–æ–≤–ª–µ–Ω–æ/–¥–æ–±–∞–≤–ª–µ–Ω–æ/—É–¥–∞–ª–µ–Ω–æ —Ä–∞–∑–º–µ—Ä–æ–≤
        """
        try:
            update.update_prices_db()
        except KeyboardInterrupt:
            print("\n‚ö†Ô∏è  –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    
    def do_cleanup_db(self, arg):
        """
        –û—á–∏—â–∞–µ—Ç –ë–î –æ—Ç —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –∏–ª–∏ –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π.
        
        –ß–¢–û –î–ï–õ–ê–ï–¢:
        - –£–¥–∞–ª—è–µ—Ç —Ç–æ–≤–∞—Ä—ã —Å –ø–æ–º–µ—Ç–∫–æ–π "—É–¥–∞–ª–µ–Ω"
        - –û—á–∏—â–∞–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–ø–∏—Å–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        - –£–¥–∞–ª—è–µ—Ç –Ω–µ—Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –ª–æ–≥-—Ñ–∞–π–ª–æ–≤
        
        –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
          cleanup-db
        
        –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø:
        - –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è (–Ω–µ —É–¥–∞–ª—è–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)
        - –ü–æ–º–æ–≥–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –ë–î –≤ —á–∏—Å—Ç–æ—Ç–µ
        - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏
        """
        try:
            cmd_utils.cleanup_db()
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    
    def do_delete_all_woo(self, arg):
        """
        –£–¥–∞–ª—è–µ—Ç –í–°–ï —Ç–æ–≤–∞—Ä—ã —Å WooCommerce —Å–∞–π—Ç–∞.
        
        –ß–¢–û –î–ï–õ–ê–ï–¢:
        - –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ WordPress
        - –£–¥–∞–ª—è–µ—Ç –∫–∞–∂–¥—ã–π —Ç–æ–≤–∞—Ä —á–µ—Ä–µ–∑ WooCommerce API
        - –ù–ï —É–¥–∞–ª—è–µ—Ç —Ç–æ–≤–∞—Ä—ã –∏–∑ –ë–î (—Ç–æ–ª—å–∫–æ —Å —Å–∞–π—Ç–∞!)
        
        –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
          delete-all-woo
        
        –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø:
        - ‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –ù–ï–û–ë–†–ê–¢–ò–ú–û!
        - –ë–î –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç–æ–π
        - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ sync-new –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–∞–π—Ç
        - –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        """
        try:
            cmd_utils.delete_all_woo_products()
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    
    # ==================== –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø ====================
    
    def do_sync_new(self, arg):
        """
        –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –ù–û–í–´–ï —Ç–æ–≤–∞—Ä—ã —Å WooCommerce (–µ—â–µ –Ω–µ –Ω–∞ —Å–∞–π—Ç–µ).
        
        –ß–¢–û –î–ï–õ–ê–ï–¢:
        - –ù–∞—Ö–æ–¥–∏—Ç —Ç–æ–≤–∞—Ä—ã –≤ –ë–î, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –Ω–∞ —Å–∞–π—Ç–µ (–±–µ–∑ wp_product_id)
        - –°–æ–∑–¥–∞–µ—Ç –∏—Ö –Ω–∞ WordPress —Å –≤–∞—Ä–∏–∞—Ü–∏—è–º–∏ —Ä–∞–∑–º–µ—Ä–æ–≤
        - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –∞—Ç—Ä–∏–±—É—Ç—ã (pa_days)
        - –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–æ—Ä–º—É–ª—ã —Ü–µ–Ω –∏–∑ price_formulas.json
        - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–≤—è–∑—å –ë–î ‚Üî WordPress
        
        –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
          sync-new
        
        –ö–û–ì–î–ê –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨:
        - –ü–æ—Å–ª–µ add-articles –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å–∞–π—Ç
        - –ü–æ—Å–ª–µ load-data –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–æ–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        - –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä—ã –µ—Å—Ç—å –≤ –ë–î, –Ω–æ –Ω–µ –Ω–∞ —Å–∞–π—Ç–µ
        
        –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø:
        - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã —Å data_loaded=True
        - –ù–ï –∏–∑–º–µ–Ω—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–æ–≤–∞—Ä—ã –Ω–∞ —Å–∞–π—Ç–µ
        - –°–æ–∑–¥–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –ª–æ–≥-—Ñ–∞–π–ª –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SKU-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        """
        try:
            sync.sync_new()
        except KeyboardInterrupt:
            print("\n‚ö†Ô∏è  –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    
    def do_sync_all(self, arg):
        """
        –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å WooCommerce (—Å–æ–∑–¥–∞–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ).
        
        –ß–¢–û –î–ï–õ–ê–ï–¢:
        - –ü–æ–ª—É—á–∞–µ—Ç –í–°–ï —Ç–æ–≤–∞—Ä—ã —Å —Å–∞–π—Ç–∞ WordPress
        - –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã (–µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç –Ω–∞ —Å–∞–π—Ç–µ)
        - –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–æ–≤–∞—Ä—ã (–µ—Å–ª–∏ –æ–Ω–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –≤ –ë–î)
        - –£–¥–∞–ª—è–µ—Ç —Ç–æ–≤–∞—Ä—ã —Å —Å–∞–π—Ç–∞, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ –ë–î
        - –£–¥–∞–ª—è–µ—Ç —Ç–æ–≤–∞—Ä—ã –±–µ–∑ –Ω–∞–ª–∏—á–∏—è (out of stock)
        - –û–±–Ω–æ–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Ü–µ–Ω—ã, —Ä–∞–∑–º–µ—Ä—ã
        
        –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
          sync-all
          sync-all --dry-run
        
        –û–ü–¶–ò–ò:
          --dry-run   –†–µ–∂–∏–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω–æ)
        
        –ö–û–ì–î–ê –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨:
        - –î–ª—è –ø–æ–ª–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ë–î ‚Üî WordPress
        - –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î (update-db)
        - –î–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –±–µ–∑ –Ω–∞–ª–∏—á–∏—è —Å —Å–∞–π—Ç–∞
        - –î–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ë–î –∏ —Å–∞–π—Ç–∞
        
        –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø:
        - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã —Å data_loaded=True
        - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SKU-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        - –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–æ—Ä–º—É–ª—ã —Ü–µ–Ω –∏–∑ price_formulas.json
        - –£–¥–∞–ª—è–µ—Ç —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ –ë–î (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å!)
        - –°–æ–∑–¥–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã –≤ —Ä–µ–∂–∏–º–µ "—á–µ—Ä–Ω–æ–≤–∏–∫" –µ—Å–ª–∏ out of stock
        """
        dry_run = '--dry-run' in arg
        try:
            sync.sync_all(dry_run)
        except KeyboardInterrupt:
            print("\n‚ö†Ô∏è  –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    
    def do_sync_prices(self, arg):
        """
        –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ —Ü–µ–Ω—ã —Å WooCommerce (–±—ã—Å—Ç—Ä–µ–µ —á–µ–º sync-all).
        
        –ß–¢–û –î–ï–õ–ê–ï–¢:
        - –û–±–Ω–æ–≤–ª—è–µ—Ç —Ü–µ–Ω—ã –≤—Å–µ—Ö –≤–∞—Ä–∏–∞—Ü–∏–π —Ä–∞–∑–º–µ—Ä–æ–≤
        - –ù–ï –∏–∑–º–µ–Ω—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –æ–ø–∏—Å–∞–Ω–∏—è, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        - –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–æ—Ä–º—É–ª—ã –∏–∑ price_formulas.json
        
        –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
          sync-prices
        
        –ö–û–ì–î–ê –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨:
        - –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—É–ª –≤ price_formulas.json
        - –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω –Ω–∞ —Å–∞–π—Ç–µ
        - –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ü–µ–Ω—ã –±–µ–∑ –¥—Ä—É–≥–∏—Ö –¥–∞–Ω–Ω—ã—Ö
        
        –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø:
        - –ë—ã—Å—Ç—Ä–µ–µ —á–µ–º sync-all (–Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
        - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–æ–≤–∞—Ä—ã –Ω–∞ —Å–∞–π—Ç–µ
        - –£—á–∏—Ç—ã–≤–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–æ–≤–∞—Ä–∞ –∏ —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏ (pa_days)
        """
        try:
            sync.sync_prices()
        except KeyboardInterrupt:
            print("\n‚ö†Ô∏è  –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    
    def do_update_prices_full(self, arg):
        """
        –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω: –ë–î + —Å–∞–π—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–∫–æ–º–±–∏–Ω–∞—Ü–∏—è –¥–≤—É—Ö –∫–æ–º–∞–Ω–¥).
        
        –ß–¢–û –î–ï–õ–ê–ï–¢:
        1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã –∏–∑ Dewu API
        2. –û–±–Ω–æ–≤–ª—è–µ—Ç —Ü–µ–Ω—ã –≤ –ë–î
        3. –°—Ä–∞–∑—É –∂–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Ü–µ–Ω—ã –Ω–∞ WooCommerce
        4. –°–∫—Ä—ã–≤–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã –±–µ–∑ —Ä–∞–∑–º–µ—Ä–æ–≤ (–≤ –ë–î –∏ –Ω–∞ —Å–∞–π—Ç–µ)
        
        –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
          update-prices-full
        
        –ö–û–ì–î–ê –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨:
        - –î–ª—è –ø–æ–ª–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω (–ë–î + —Å–∞–π—Ç –∑–∞ –æ–¥–∏–Ω —Ä–∞–∑)
        - –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—É–ª –≤ price_formulas.json
        - –î–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞–ª–∏—á–∏—è –∏ —Ü–µ–Ω
        
        –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê:
        - –ë—ã—Å—Ç—Ä–µ–µ —á–µ–º –∑–∞–ø—É—Å–∫–∞—Ç—å update-prices-db + sync-prices –æ—Ç–¥–µ–ª—å–Ω–æ
        - –û–¥–∏–Ω –ø—Ä–æ—Ö–æ–¥ –ø–æ –≤—Å–µ–º —Ç–æ–≤–∞—Ä–∞–º
        - –°—Ä–∞–∑—É –≤–∏–¥–Ω—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ —Å–∞–π—Ç–µ
        - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã –±–µ–∑ —Ä–∞–∑–º–µ—Ä–æ–≤
        
        –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø:
        - –°–æ–±–ª—é–¥–∞–µ—Ç rate limit Dewu API (0.5 req/sec)
        - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã —Å data_loaded=True
        - –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–æ—Ä–º—É–ª—ã –∏–∑ price_formulas.json
        - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –ë–î –∏ WordPress
        - –í—Ä–µ–º—è: ~2.3 —Å–µ–∫ –Ω–∞ —Ç–æ–≤–∞—Ä (2 —Å–µ–∫ API + 0.3 —Å–µ–∫ WP)
        """
        try:
            sync_prices_full.update_prices_full()
        except KeyboardInterrupt:
            print("\n‚ö†Ô∏è  –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
            import traceback
            traceback.print_exc()
    
    
    # ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –¢–û–í–ê–†–ê–ú–ò ====================
    def do_product_info(self, arg):
        """
        –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–≤–∞—Ä–µ –∏–∑ –ë–î.
        
        –ß–¢–û –î–ï–õ–ê–ï–¢:
        - –í—ã–≤–æ–¥–∏—Ç –≤—Å—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–≤–∞—Ä–µ –∏–∑ –ë–î
        - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –≤–∞—Ä–∏–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–æ–≤ —Å —Ü–µ–Ω–∞–º–∏
        - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, SKU ID
        - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å WordPress
        
        –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
          product-info --id=<Product_ID>
          product-info --spu=<SPU_ID>
        
        –ü–†–ò–ú–ï–†–´:
          product-info --id=8
          product-info --spu=3366243
        
        –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø:
        - --id = –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π Product ID –≤ –ë–î
        - --spu = SPU ID –∏–∑ Dewu
        - –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        """
        if not arg:
            print("‚ùå –£–∫–∞–∂–∏—Ç–µ --id –∏–ª–∏ --spu")
            return
        
        product_id = None
        spu = None
        
        for a in arg.split():
            if a.startswith('--id='):
                product_id = int(a.split('=')[1])
            elif a.startswith('--spu='):
                spu = a.split('=')[1]
        
        try:
            manage.product_info(product_id, spu)
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    
    def do_delete_stubs(self, arg):
        """
        –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –∑–∞–≥–ª—É—à–∫–∏ (—Ç–æ–≤–∞—Ä—ã –±–µ–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö) –∏–∑ –ë–î.
        
        –ß–¢–û –î–ï–õ–ê–ï–¢:
        - –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ —Ç–æ–≤–∞—Ä—ã —Å data_loaded=False
        - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∑–∞–≥–ª—É—à–µ–∫
        - –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
        - –£–¥–∞–ª—è–µ—Ç –∑–∞–≥–ª—É—à–∫–∏ –∏–∑ –ë–î
        
        –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
          delete-stubs
        
        –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø:
        - –ó–∞–≥–ª—É—à–∫–∏ - —ç—Ç–æ —Ç–æ–≤–∞—Ä—ã, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ API
        - –û–±—ã—á–Ω–æ —Å–æ–∑–¥–∞—é—Ç—Å—è –∫–æ–º–∞–Ω–¥–æ–π add-articles –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∑–∞–≥—Ä—É–∑–∫–∏
        - –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ë–î –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π
        - –û–ø–µ—Ä–∞—Ü–∏—è –Ω–µ–æ–±—Ä–∞—Ç–∏–º–∞!
        """
        try:
            manage.delete_stubs()
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    
    def do_fix_backpacks(self, arg):
        """
        –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è —Ä—é–∫–∑–∞–∫–æ–≤.
        
        –ß–¢–û –î–ï–õ–ê–ï–¢:
        - –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ —Ä—é–∫–∑–∞–∫–∏ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ [1182 (–†—é–∫–∑–∞–∫–∏ –ñ), 19 (Uncategorized)]
        - –ó–∞–º–µ–Ω—è–µ—Ç 19 (Uncategorized) –Ω–∞ 119 (–†—é–∫–∑–∞–∫–∏ –ú)
        - –ò—Ç–æ–≥–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: [1182 (–†—é–∫–∑–∞–∫–∏ –ñ), 119 (–†—é–∫–∑–∞–∫–∏ –ú)]
        - –û–±–Ω–æ–≤–ª—è–µ—Ç –≤ –ë–î
        - –û–±–Ω–æ–≤–ª—è–µ—Ç –Ω–∞ —Å–∞–π—Ç–µ —á–µ—Ä–µ–∑ WooCommerce API
        
        –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
          fix-backpacks
        
        –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø:
        - –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ [1182, 19]
        - –û–±–Ω–æ–≤–ª—è–µ—Ç –∏ –ë–î, –∏ —Å–∞–π—Ç
        - –¢—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
        """
        try:
            manage.fix_backpack_categories()
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    
    # ==================== –û–¢–ß–ï–¢–´ ====================
    
    def do_stats(self, arg):
        """
        –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç–æ–≤–∞—Ä–æ–≤ –≤ –ë–î
        
        –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: stats
        
        –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
          ‚Ä¢ –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –ë–î
          ‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
          ‚Ä¢ –¢–æ–≤–∞—Ä—ã –≤ –Ω–∞–ª–∏—á–∏–∏ vs –Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏
          ‚Ä¢ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ vs –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
        """
        try:
            reports.stats()
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    
    def do_fix_single_size(self, arg):
        """
        –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä—ã —Å 1 —Ä–∞–∑–º–µ—Ä–æ–º –≤ –ë–î
        
        –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: fix-single-size
        
        –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –Ω–∞—Ö–æ–¥–∏—Ç –≤—Å–µ —Ç–æ–≤–∞—Ä—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –≤ –ë–î —Ç–æ–ª—å–∫–æ 1 —Ä–∞–∑–º–µ—Ä,
        –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏—Ö –¥–∞–Ω–Ω—ã–µ —Å Dewu API, –∑–∞–≥—Ä—É–∂–∞—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã.
        
        üìä –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:
        - –ù–∞—Ö–æ–¥–∏—Ç —Ç–æ–≤–∞—Ä—ã —Å 1 –≤–∞—Ä–∏–∞–Ω—Ç–æ–º –≤ –ë–î
        - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ API
        - –û–±–Ω–æ–≤–ª—è–µ—Ç –≤—Å–µ —Ä–∞–∑–º–µ—Ä—ã –∏ —Ü–µ–Ω—ã
        - –û—Ç—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
        
        ‚è±Ô∏è  –°–∫–æ—Ä–æ—Å—Ç—å: 2 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ —Ç–æ–≤–∞—Ä (0.5 req/sec)
        """
        try:
            fix_single_size.fix_single_size_products()
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    
    def do_fix_duplicate_images(self, arg):
        """
        –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä—ã —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
        
        –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: fix-duplicate-images
        
        –ù–∞—Ö–æ–¥–∏—Ç —Ç–æ–≤–∞—Ä—ã (—Ä–∞–∑–Ω—ã–µ SKU –æ–¥–Ω–æ–≥–æ SPU) —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
        –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏—Ö –¥–∞–Ω–Ω—ã–µ, –∑–∞–≥—Ä—É–∂–∞—è SKU-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
        
        üìä –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:
        - –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç —Ç–æ–≤–∞—Ä—ã –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º
        - –ù–∞—Ö–æ–¥–∏—Ç –≥—Ä—É–ø–ø—ã —Å –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏
        - –û–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
        - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å WordPress
        
        ‚è±Ô∏è  –°–∫–æ—Ä–æ—Å—Ç—å: 2 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ —Ç–æ–≤–∞—Ä (0.5 req/sec)
        """
        try:
            fix_images.fix_duplicate_images()
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    
    def do_category_report(self, arg):
        """
        –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Ç—á–µ—Ç –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Ç–æ–≤–∞—Ä–æ–≤.
        
        –ß–¢–û –î–ï–õ–ê–ï–¢:
        - –í—ã–≤–æ–¥–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ø N –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Ç–æ–≤–∞—Ä–æ–≤
        - –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤
        
        –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
          category-report
          category-report --top=<N>
        
        –û–ü–¶–ò–ò:
          --top=<N>   –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ø N –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10)
        
        –ü–†–ò–ú–ï–†–´:
          category-report
          category-report --top=15
        
        –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø:
        - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±–µ—Ä—É—Ç—Å—è –∏–∑ plummy_categories.json
        - –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –≤ –ë–î
        """
        top = 10
        
        if arg:
            for a in arg.split():
                if a.startswith('--top='):
                    top = int(a.split('=')[1])
        
        try:
            reports.category_report(top)
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    
    # ==================== –£–¢–ò–õ–ò–¢–´ ====================
    
    def do_config(self, arg):
        """
        –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã.
        
        –ß–¢–û –î–ï–õ–ê–ï–¢:
        - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ .env
        - –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å API –∏ WordPress
        
        –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
          config show                    –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
          config set <–∫–ª—é—á> <–∑–Ω–∞—á–µ–Ω–∏–µ>   –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É
          config test                    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        
        –ü–†–ò–ú–ï–†–´:
          config show
          config set POIZON_API_KEY "–Ω–æ–≤—ã–π_–∫–ª—é—á"
          config test
        
        –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø:
        - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ .env —Ñ–∞–π–ª–µ
        - –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
        - config test –ø—Ä–æ–≤–µ—Ä—è–µ—Ç Dewu API –∏ WordPress API
        """
        args = arg.split(None, 2)
        
        if not args:
            print("‚ùå –£–∫–∞–∂–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ: show, set –∏–ª–∏ test")
            return
        
        action = args[0]
        key = args[1] if len(args) > 1 else None
        value = args[2].strip('"\'') if len(args) > 2 else None
        
        try:
            cmd_utils.config_manage(action, key, value)
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    
    def do_backup(self, arg):
        """
        –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—ç–∫–∞–ø–∞–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
        
        –ß–¢–û –î–ï–õ–ê–ï–¢:
        - –°–æ–∑–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ë–î (plummy_scraper.db)
        - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –±—ç–∫–∞–ø–æ–≤
        - –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ë–î –∏–∑ –±—ç–∫–∞–ø–∞
        
        –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
          backup                    –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –±—ç–∫–∞–ø
          backup --list             –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –±—ç–∫–∞–ø–æ–≤
          backup --restore <–∏–º—è>    –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±—ç–∫–∞–ø
        
        –ü–†–ò–ú–ï–†–´:
          backup
          backup --list
          backup --restore 2025-10-13_0430
        
        –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø:
        - –ë—ç–∫–∞–ø—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥ backups/
        - –ò–º—è –±—ç–∫–∞–ø–∞: plummy_scraper_YYYY-MM-DD_HHMM.db
        - –í–ù–ò–ú–ê–ù–ò–ï: restore –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é –ë–î!
        """
        list_backups = '--list' in arg
        restore = None
        
        if '--restore' in arg:
            parts = arg.split()
            for i, part in enumerate(parts):
                if part == '--restore' and i + 1 < len(parts):
                    restore = parts[i + 1]
                    break
        
        try:
            cmd_utils.backup_manage(list_backups, restore)
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    
    def do_test_api(self, arg):
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å Dewu API.
        
        –ß–¢–û –î–ï–õ–ê–ï–¢:
        - –¢–µ—Å—Ç–∏—Ä—É–µ—Ç API –∫–ª—é—á Dewu
        - –î–µ–ª–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ API
        - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞
        - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        
        –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
          test-api
        
        –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø:
        - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç API –∫–ª—é—á –∏–∑ .env (POIZON_API_KEY)
        - –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º —Å API
        - –ù–µ —Ä–∞—Å—Ö–æ–¥—É–µ—Ç –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ (1-2 –∑–∞–ø—Ä–æ—Å–∞)
        """
        try:
            cmd_utils.test_api()
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    
    # ==================== –°–õ–£–ñ–ï–ë–ù–´–ï –ö–û–ú–ê–ù–î–´ ====================
    
    def do_clear(self, arg):
        """
        –û—á–∏—â–∞–µ—Ç —ç–∫—Ä–∞–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª–∞.
        
        –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
          clear
        """
        os.system('clear' if os.name != 'nt' else 'cls')
    
    def default(self, line):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ (–≤–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ —Å—Å—ã–ª–∫–∏)"""
        line = line.strip()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ —Å—Å—ã–ª–∫–æ–π
        if line.startswith('http://') or line.startswith('https://'):
            self.pending_links.append(line)
            print(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ {len(self.pending_links)}: {line[:60]}...")
            print("üí° –í—Å—Ç–∞–≤—å—Ç–µ –µ—â–µ —Å—Å—ã–ª–∫–∏ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
            return
        
        # –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ —Å—Å—ã–ª–∫–∞ - –≤—ã–≤–æ–¥–∏–º –æ—à–∏–±–∫—É –∫–∞–∫ –æ–±—ã—á–Ω–æ
        print(f"‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞: '{line}'")
        print("   –í–≤–µ–¥–∏—Ç–µ 'help' –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥")
    
    def emptyline(self):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–∏ - –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏, –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏—Ö"""
        if self.pending_links:
            print(f"\nüîó –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é {len(self.pending_links)} –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫...\n")
            # –í—ã–∑—ã–≤–∞–µ–º add_articles —Å –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏
            try:
                articles.add_articles(tuple(self.pending_links))
            except Exception as e:
                print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
            finally:
                self.pending_links = []  # –û—á–∏—â–∞–µ–º –±—É—Ñ–µ—Ä
        # –ò–Ω–∞—á–µ –ø—Ä–æ—Å—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º (–Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∫–æ–º–∞–Ω–¥—É)
    
    def do_exit(self, arg):
        """
        –í—ã—Ö–æ–¥ –∏–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã.
        
        –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
          exit
          quit
        """
        print("\nüëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!")
        return True
    
    def do_quit(self, arg):
        """
        –í—ã—Ö–æ–¥ –∏–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ exit).
        
        –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
          quit
          exit
        """
        return self.do_exit(arg)
    
    def emptyline(self):
        """–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏"""
        pass
    
    def default(self, line):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–æ–º–∞–Ω–¥"""
        print(f"‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞: '{line}'")
        print("–í–≤–µ–¥–∏—Ç–µ 'help' –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥")
    


def main():
    """–ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –æ–±–æ–ª–æ—á–∫–∏"""
    try:
        PlummyShell().cmdloop()
    except KeyboardInterrupt:
        print("\n\nüëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!")
        sys.exit(0)


if __name__ == '__main__':
    main()

