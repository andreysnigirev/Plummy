# –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –∏ —Ü–µ–Ω–∞–º–∏

## üö® –ü—Ä–æ–±–ª–µ–º–∞

–í—Å–µ —Ç—Ä–∏ –∫–æ–º–∞–Ω–¥—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω (`update-prices-db`, `sync-prices`, `update-prices-full`) –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ **–ù–ï–ü–†–ê–í–ò–õ–¨–ù–£–Æ –∫–∞—Ç–µ–≥–æ—Ä–∏—é** –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ —Ü–µ–Ω, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ **–æ–¥–∏–Ω–∞–∫–æ–≤—ã–º —Ü–µ–Ω–∞–º** –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ä–æ–∫–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏.

## üîç –ü—Ä–∏—á–∏–Ω–∞

### –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:

```python
product.category_id = 38  # –°—Ç–∞—Ä–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –∏–∑ Dewu API
product.category_ids = [103, 154]  # –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ WooCommerce
```

### –ü—Ä–æ–±–ª–µ–º–∞:
1. –ü–æ–ª–µ `category_id` —Å–æ–¥–µ—Ä–∂–∞–ª–æ **—Å—Ç–∞—Ä—ã–µ ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ Dewu API** (38, 33, 1001176, etc.)
2. –ü–æ–ª–µ `category_ids` —Å–æ–¥–µ—Ä–∂–∞–ª–æ **–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π WooCommerce** (103, 154, etc.)
3. –ö–æ–º–∞–Ω–¥—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ `product.category_id` –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ü–µ–Ω

### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:

–î–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ 38 **–Ω–µ –±—ã–ª–æ —Ñ–æ—Ä–º—É–ª** –≤ `price_formulas.json`, –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è **hardcoded –¥–µ—Ñ–æ–ª—Ç**:

```python
# –í price_calculator.py
return self.default_formula.get(delivery_days, "(x * a + 400) * b")
```

–î–µ—Ñ–æ–ª—Ç–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ –±—ã–ª–∞ **–û–î–ò–ù–ê–ö–û–í–ê–Ø** –¥–ª—è –æ–±–æ–∏—Ö —Å—Ä–æ–∫–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏:
- `"21-26 –¥–Ω–µ–π"`: `"(x * a + 400) * b"`
- `"10-14 –¥–Ω–µ–π"`: `"(x * a + 400) * b"`  ‚Üê **–ë–µ–∑ +600!**

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¶–µ–Ω—ã –Ω–µ —Ä–∞–∑–ª–∏—á–∞–ª–∏—Å—å –º–µ–∂–¥—É —Å—Ä–æ–∫–∞–º–∏ –¥–æ—Å—Ç–∞–≤–∫–∏.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ `category_id` –≤ –ë–î

–û–±–Ω–æ–≤–ª–µ–Ω–æ **1115 —Ç–æ–≤–∞—Ä–æ–≤** –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:

```python
# –î–û
product.category_id = 38  # –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
product.category_ids = [103, 154]

# –ü–û–°–õ–ï
product.category_id = 103  # –ü—Ä–∞–≤–∏–ª—å–Ω–æ! (–ø–µ—Ä–≤–∞—è –∏–∑ category_ids)
product.category_ids = [103, 154]
```

**–ö–æ–º–∞–Ω–¥–∞:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —Å–∫—Ä–∏–ø—Ç–æ–º `fix_category_ids_in_db.py`

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ `default` –≤ `price_formulas.json`

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è `"default"` —Å **–†–ê–ó–ù–´–ú–ò** —Ñ–æ—Ä–º—É–ª–∞–º–∏:

```json
{
  "formulas": {
    "default": {
      "21-26 –¥–Ω–µ–π": "(x*a+1500)*b",
      "10-14 –¥–Ω–µ–π": "(x*a+2200)*b"
    },
    "categories": {
      ...
    }
  }
}
```

–¢–µ–ø–µ—Ä—å, –µ—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ—Ç –≤ —Å–ø–∏—Å–∫–µ, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã —Å **—Ä–∞–∑–Ω–∏—Ü–µ–π 700 RUB**.

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–∞–Ω–¥

–í—Å–µ —Ç—Ä–∏ –∫–æ–º–∞–Ω–¥—ã —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—é—Ç **–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**:

#### `update-prices-db`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `product.category_id` (—Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π)
- ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ü–µ–Ω—ã –≤ –ë–î
- ‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–æ—Ä–º—É–ª—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

#### `sync-prices`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `product.category_id` (—Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π)
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç 2 –≤–∞—Ä–∏–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
- ‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ä–∞–∑–Ω—ã–µ —Ü–µ–Ω—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ä–æ–∫–æ–≤

#### `update-prices-full`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `product.category_id` (—Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π)
- ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç –ë–î + —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å —Å–∞–π—Ç–æ–º
- ‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–æ—Ä–º—É–ª—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞

### Nike Dunk SB Dunk Low Burnt Sunrise (SPU 11119647)

**–î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
category_id: 38 (–Ω–µ—Ç —Ñ–æ—Ä–º—É–ª)
–†–∞–∑–º–µ—Ä 36:
  21-26 –¥–Ω–µ–π: 8596 RUB
  10-14 –¥–Ω–µ–π: 8596 RUB
  –†–∞–∑–Ω–∏—Ü–∞: 0 RUB ‚ùå
```

**–ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
category_id: 103 (–ö—Ä–æ—Å—Å–æ–≤–∫–∏ –ú)
–†–∞–∑–º–µ—Ä 36:
  21-26 –¥–Ω–µ–π: 9916 RUB
  10-14 –¥–Ω–µ–π: 10756 RUB
  –†–∞–∑–Ω–∏—Ü–∞: 840 RUB ‚úÖ
```

## ‚ö° –î–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 1. –í—Å–µ —Ç–æ–≤–∞—Ä—ã –≤ –ë–î –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚úÖ

### 2. –û–±–Ω–æ–≤–∏—Ç–µ —Ü–µ–Ω—ã –Ω–∞ —Å–∞–π—Ç–µ:

```bash
poetry run python plummy.py
>>> sync-all
```

–≠—Ç–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Å—Ç –≤—Å–µ –≤–∞—Ä–∏–∞—Ü–∏–∏ —Å **–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏**.

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞:
- –û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±–æ–π —Ç–æ–≤–∞—Ä –Ω–∞ —Å–∞–π—Ç–µ
- –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä
- –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ —Å—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏ (21-26 –¥–Ω–µ–π ‚Üî 10-14 –¥–Ω–µ–π)
- **–¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –º–µ–Ω—è—Ç—å—Å—è!**

## üìù –í–∞–∂–Ω—ã–µ –≤—ã–≤–æ–¥—ã

### –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ?

1. **–†–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:**
   - `category_id` - –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ Dewu API
   - `category_ids` - –∏–∑ WooCommerce

2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**
   - –ù–µ –±—ã–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è `category_id` –∏ `category_ids[0]`

3. **–ù–µ–ø–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
   - –í `price_formulas.json` –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ —Å–µ–∫—Ü–∏—è `"default"`

### –ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å –≤ –±—É–¥—É—â–µ–º?

1. **–í—Å–µ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å `category_id = category_ids[0]`** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞
2. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏–º–µ—Ç—å `"default"`** –≤ `price_formulas.json`
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –Ω–∞ —Å–∞–π—Ç

## üéØ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤:** 1115
- **–£–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö:** 383
- **–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤:** 1498
- **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å:** 100%

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `Product` –≤ –ë–î:

```python
class Product(Base):
    ...
    category_id = Column(Integer)        # ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ü–µ–Ω
    category_ids = Column(JSON)          # –°–ø–∏—Å–æ–∫ ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π WooCommerce
    ...
```

### –õ–æ–≥–∏–∫–∞ –≤ `create_variations`:

```python
# wordpress_sync.py, —Å—Ç—Ä–æ–∫–∞ 517
category_id = category_id_for_price or product.category_id or 103

# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ü–µ–Ω:
price_rub = price_calculator.calculate_price(
    variant.price_cny,
    category_id,        # ‚Üê –ö–†–ò–¢–ò–ß–ù–û! –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º
    delivery_days
)
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–∞—Ö:

1. **`price_formulas.json`:**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è `"default"`

2. **`database.py`:**
   - –û–±–Ω–æ–≤–ª–µ–Ω–æ 1115 –∑–∞–ø–∏—Å–µ–π
   - `category_id = category_ids[0]`

3. **–ö–æ–º–∞–Ω–¥—ã (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π):**
   - –ö–æ–¥ —Ä–∞–±–æ—Ç–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ –¥–∞–Ω–Ω—ã—Ö

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ **–ù–ï –≤ –∫–æ–¥–µ –∫–æ–º–∞–Ω–¥**, –∞ –≤ **–¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑–µ**:
- –ö–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ù–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ `category_id`

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö **–≤—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ**:
- ‚úÖ `update-prices-db`
- ‚úÖ `sync-prices`
- ‚úÖ `update-prices-full`

**–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞!** üéâ

