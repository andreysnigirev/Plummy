# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ sku_id –≤–æ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥–∞—Ö

**–î–∞—Ç–∞:** 18 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û

---

## üìã –ó–∞–¥–∞—á–∞

–û–±–µ—Å–ø–µ—á–∏—Ç—å, —á—Ç–æ–±—ã **–í–°–ï –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–ª–∏ —Å –ø–æ–ª–µ–º `sku_id`:
- –ù–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã —á–µ—Ä–µ–∑ `add-articles` –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å `sku_id` —Å—Ä–∞–∑—É
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –¥–æ–ª–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å `sku_id`
- –§–æ—Ä–º—É–ª—ã —Ü–µ–Ω –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üîç –ü—Ä–æ–±–ª–µ–º–∞ (–î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

### 1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–ª—è `sku_id` –≤ –º–æ–¥–µ–ª–∏
```python
class ProductVariant(Base):
    id = Column(Integer, primary_key=True)
    product_id = Column(Integer, ForeignKey('products.id'))
    size_eu = Column(String(10))
    # ‚ùå –ù–ï–¢ sku_id!
```

### 2. –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ë–î
- **11,963 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤** –≤ –ë–î –∏–º–µ–ª–∏ `sku_id = NULL`
- –ö–æ–º–∞–Ω–¥–∞ `update-prices-full` –Ω–µ –º–æ–≥–ª–∞ —Å–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã
- –¶–µ–Ω—ã –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∏—Å—å –¥–∞–∂–µ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—É–ª

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `sku_id` –≤ –º–æ–¥–µ–ª—å

```python
class ProductVariant(Base):
    id = Column(Integer, primary_key=True)
    product_id = Column(Integer, ForeignKey('products.id'))
    sku_id = Column(String(50))  # ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û!
    size_eu = Column(String(10))
    # ...
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ –ë–î

```sql
ALTER TABLE product_variants ADD COLUMN sku_id VARCHAR(50);
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –º–µ—Ç–æ–¥—ã —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

#### `db.add_product()` (—Å—Ç—Ä–æ–∫–∞ 337)
```python
variant = ProductVariant(
    sku_id=variant_data.get('sku_id'),  # ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ–º SKU ID
    size_eu=variant_data['size_eu'],
    # ...
)
```

#### `db.load_product_data()` (—Å—Ç—Ä–æ–∫–∞ 426)
```python
variant = ProductVariant(
    product_id=product.id,
    sku_id=variant_data.get('sku_id'),  # ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ–º SKU ID
    size_eu=variant_data['size_eu'],
    # ...
)
```

#### `db.update_product()` (—Å—Ç—Ä–æ–∫–∞ 494)
```python
variant = ProductVariant(
    product_id=product.id,
    sku_id=variant_data.get('sku_id'),  # ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ–º SKU ID
    size_eu=variant_data['size_eu'],
    # ...
)
```

#### `db.update_product_prices_only()` (—Å—Ç—Ä–æ–∫–∞ 1005)
```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ sku_id
variants_with_sku = [v for v in product.variants if v.sku_id]

if not variants_with_sku and product.variants:
    logger.warning(f"–¢–æ–≤–∞—Ä {spu_id} –∏–º–µ–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã –±–µ–∑ sku_id - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ update-db")
    return {'updated': 0, 'added': 0, 'removed': 0}

# –°–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ sku_id
current_variants = {str(v.sku_id): v for v in product.variants if v.sku_id}
```

---

## üîÑ –¶–µ–ø–æ—á–∫–∞ —Ä–∞–±–æ—Ç—ã –∫–æ–º–∞–Ω–¥

### **add-articles** (–Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã)
```
–°—Å—ã–ª–∫–∞ ‚Üí API –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è ‚Üí SPU + SKU
       ‚Üì
API –∑–∞–≥—Ä—É–∑–∫–∞ ‚Üí product_processor ‚Üí variants —Å sku_id
       ‚Üì
db.add_product() ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î —Å sku_id
       ‚Üì
‚úÖ –¢–æ–≤–∞—Ä –≤ –ë–î —Å sku_id –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Ñ–æ—Ä–º—É–ª–∞–º–∏
```

### **update-db** (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö)
```
–¢–æ–≤–∞—Ä—ã –∏–∑ –ë–î ‚Üí API –∑–∞–≥—Ä—É–∑–∫–∞ ‚Üí product_processor
       ‚Üì
variants —Å sku_id ‚Üí db.update_product()
       ‚Üì
‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å sku_id –∏ –Ω–æ–≤—ã–º–∏ —Ñ–æ—Ä–º—É–ª–∞–º–∏
```

### **update-prices-full** (–±—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω)
```
–¢–æ–≤–∞—Ä—ã –∏–∑ –ë–î ‚Üí API –∑–∞–≥—Ä—É–∑–∫–∞ –¢–û–õ–¨–ö–û —Ü–µ–Ω
       ‚Üì
–°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ sku_id ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω
       ‚Üì
–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
       ‚Üì
‚úÖ –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –ú–µ—Ç–æ–¥ –ë–î | –°—Ç–∞—Ç—É—Å |
|---------|----------|--------|
| `add-articles` | `db.add_product()` | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| `update-db` | `db.load_product_data()` + `db.update_product()` | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| `update-prices-full` | `db.update_product_prices_only()` | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| `fix-single-size` | `db.update_product()` | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| `full-restore` | `db.add_product_stub()` + `db.load_product_data()` | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |

---

## üìù –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ –∫–æ–¥–µ

### –§–∞–π–ª—ã:
1. ‚úÖ `database.py` - 4 –º–µ—Ç–æ–¥–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
2. ‚úÖ `README.md` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
3. ‚úÖ `–ò–ù–°–¢–†–£–ö–¶–ò–Ø_–ó–ê–ü–£–°–ö.md` - –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
4. ‚úÖ `–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_SKU_ID.md` - —ç—Ç–æ—Ç –æ—Ç—á–µ—Ç

### –°—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞:
- **–ò–∑–º–µ–Ω–µ–Ω–æ:** ~40 —Å—Ç—Ä–æ–∫
- **–î–æ–±–∞–≤–ª–µ–Ω–æ:** ~20 —Å—Ç—Ä–æ–∫
- **–ú–µ—Ç–æ–¥–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–æ:** 4

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –î–ª—è –ù–û–í–´–• —Ç–æ–≤–∞—Ä–æ–≤:
‚úÖ –ö–æ–º–∞–Ω–¥–∞ `add-articles` —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `sku_id`  
‚úÖ –§–æ—Ä–º—É–ª—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –î–ª—è –°–£–©–ï–°–¢–í–£–Æ–©–ò–• —Ç–æ–≤–∞—Ä–æ–≤:
‚ö†Ô∏è –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å **–æ–¥–∏–Ω —Ä–∞–∑**:
```bash
poetry run python plummy.py
>>> update-db
```

–≠—Ç–æ –∑–∞–ø–æ–ª–Ω–∏—Ç `sku_id` –¥–ª—è –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.

### –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ:
‚úÖ `update-prices-full` –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ  
‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª –±—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –∫–æ –≤—Å–µ–º —Ç–æ–≤–∞—Ä–∞–º  
‚úÖ –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫

---

## üéØ –ò—Ç–æ–≥

### ‚úÖ –î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ:
- –ü–æ–ª–µ `sku_id` –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –º–æ–¥–µ–ª—å –∏ –ë–î
- –í—Å–µ –º–µ—Ç–æ–¥—ã —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è `sku_id` –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Ü–µ–Ω
- –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç:
- **–ù–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã** –ø–æ–ª—É—á–∞—é—Ç `sku_id` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **–°—Ç–∞—Ä—ã–µ —Ç–æ–≤–∞—Ä—ã** –ø–æ–ª—É—á–∞—Ç `sku_id` –ø–æ—Å–ª–µ `update-db`
- **–í—Å–µ –∫–æ–º–∞–Ω–¥—ã** —Ä–∞–±–æ—Ç–∞—é—Ç —Å `sku_id` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–§–æ—Ä–º—É–ª—ã —Ü–µ–Ω** –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

**–ü—Ä–æ–≥—Ä–∞–º–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!** ‚úÖ

