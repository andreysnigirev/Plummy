# PlummyScraper v2.0

> –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞–º–∏ Dewu –≤ WooCommerce

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
poetry install

# –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã
poetry run python plummy.py

# –í –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –æ–±–æ–ª–æ—á–∫–µ
>>> help  # –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥
```

---

## üìã –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –†–∞–±–æ—Ç–∞ —Å —Ç–æ–≤–∞—Ä–∞–º–∏:
- `add-articles` - –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –∏–∑ —Å—Å—ã–ª–æ–∫ Dewu
- `load-data` - –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤-–∑–∞–≥–ª—É—à–µ–∫
- `update-db` - –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤
- `remove-articles <ids>` - –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä—ã (–∏–∑ –ë–î –∏ —Å–∞–π—Ç–∞)

### –†–∞–±–æ—Ç–∞ —Å —Ü–µ–Ω–∞–º–∏:
- `update-prices-db` - –û–±–Ω–æ–≤–∏—Ç—å —Ü–µ–Ω—ã –≤ –ë–î
- `sync-prices` - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–Ω—ã –Ω–∞ —Å–∞–π—Ç
- `update-prices-full` - –û–±–Ω–æ–≤–∏—Ç—å —Ü–µ–Ω—ã –≤ –ë–î –∏ –Ω–∞ —Å–∞–π—Ç–µ (–±—ã—Å—Ç—Ä–∞—è –∫–æ–º–∞–Ω–¥–∞)

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:
- `sync-new` - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã –Ω–∞ —Å–∞–π—Ç
- `sync-all` - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –Ω–∞ —Å–∞–π—Ç

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
- `stats` - –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ç–æ–≤–∞—Ä–∞–º
- `product-info <spu_id>` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ

### ‚è∏Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º:
–î–æ–ª–≥–∏–µ –∫–æ–º–∞–Ω–¥—ã (update-db –∏ –¥—Ä.) –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç:
- **`p` –∏–ª–∏ `pause`** - –ø–∞—É–∑–∞ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è
- **`restartthis`** - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å –Ω–∞—á–∞–ª–∞
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã

üìñ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: `–£–ü–†–ê–í–õ–ï–ù–ò–ï_–í–´–ü–û–õ–ù–ï–ù–ò–ï–ú.md`

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env):
```env
POIZON_API_KEY=your_api_key
WOO_SITE_URL=https://your-site.com
WOO_API_KEY=ck_xxx
WOO_API_SECRET=cs_xxx
```

### –§–æ—Ä–º—É–ª—ã —Ü–µ–Ω (price_formulas.json):
```json
{
  "parameters": {
    "a": 12,    // –ö—É—Ä—Å —é–∞–Ω—è
    "b": 1.2,   // –ù–∞—Ü–µ–Ω–∫–∞
    "c": 6      // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
  },
  "formulas": {
    "default": {
      "21-26 –¥–Ω–µ–π": "(x*a+900)*b",
      "10-14 –¥–Ω–µ–π": "(x*a+1200)*b"
    },
    "categories": {
      "103": {
        "name": "–ö—Ä–æ—Å—Å–æ–≤–∫–∏ –ú",
        "21-26 –¥–Ω–µ–π": "(x*a+1500)*b",
        "10-14 –¥–Ω–µ–π": "(x*a+2200)*b"
      }
    }
  }
}
```

---

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
- **–¢–æ–≤–∞—Ä–æ–≤:** 1,496
- **–í–∞—Ä–∏–∞–Ω—Ç–æ–≤:** ~12,000
- **–ó–∞–≥–ª—É—à–µ–∫:** 0 ‚úÖ

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (18.10.2025):
1. ‚úÖ **–û—à–∏–±–∫–∞ —Å —Ñ–µ–Ω—è–º–∏:** API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ü–µ–Ω—ã –≤ —Ñ–µ–Ω—è—Ö (1/100 —é–∞–Ω—è), —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–µ–ª–∏–º –Ω–∞ 100
2. ‚úÖ **Default —Ñ–æ—Ä–º—É–ª–∞:** –ò–∑–º–µ–Ω–µ–Ω–∞ —Å `"x"` –Ω–∞ `"(x*a+900)*b"`
3. ‚úÖ **Decimal –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å —Ü–µ–Ω–∞–º–∏
4. ‚úÖ **–ó–∞–≥–ª—É—à–∫–∏:** –£–¥–∞–ª–µ–Ω–æ 276 —Ç–æ–≤–∞—Ä–æ–≤ –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö
5. ‚úÖ **click.echo(flush=True):** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ `print(flush=True)` –≤ 3 —Ñ–∞–π–ª–∞—Ö (24 –≤—Ö–æ–∂–¥–µ–Ω–∏—è)
6. ‚úÖ **database_price_update:** –£–¥–∞–ª–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω
7. ‚úÖ **ProductVariant.sku_id:** –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ + –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã (–ø–æ–¥—Ä–æ–±–Ω–æ: `–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_SKU_ID.md`)
8. ‚úÖ **–ö–æ–Ω—Ñ–ª–∏–∫—Ç session:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç –∏–º–µ–Ω –≤ `update-db` (–ø–æ–¥—Ä–æ–±–Ω–æ: `–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø_–û–®–ò–ë–ö–ê_SESSION.md`)
9. ‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º:** –ü–∞—É–∑–∞, –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ (–ø–æ–¥—Ä–æ–±–Ω–æ: `–£–ü–†–ê–í–õ–ï–ù–ò–ï_–í–´–ü–û–õ–ù–ï–ù–ò–ï–ú.md`)
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: `async def` ‚Üí `def` –¥–ª—è `monitor_input()` (event loop –∫–æ–Ω—Ñ–ª–∏–∫—Ç)
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –ó–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏–µ –Ω–∞ –æ—à–∏–±–æ—á–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞—Ö (–¥–æ–±–∞–≤–ª–µ–Ω–æ `i += 1` –ø–µ—Ä–µ–¥ `continue`)

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** SQLite (SQLAlchemy ORM)
- **API:** Dewu API (0.5 req/sec rate limit)
- **WooCommerce:** REST API
- **–¶–µ–Ω—ã:** –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –ø–æ —Ñ–æ—Ä–º—É–ª–∞–º
- **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–ª—è –æ–±—É–≤–∏ (–ú/–ñ)

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏:
- `plummy.py` - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –æ–±–æ–ª–æ—á–∫–∞
- `product_processor.py` - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
- `price_calculator.py` - –†–∞—Å—á–µ—Ç —Ü–µ–Ω
- `database.py` - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- `wordpress_sync.py` - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å WooCommerce
- `poizon_scraper.py` - API Dewu

---

## üìù –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –¶–µ–Ω—ã:
- API Dewu –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ü–µ–Ω—ã –≤ **—Ñ–µ–Ω—è—Ö** (1/100 —é–∞–Ω—è)
- –ü—Ä–æ–≥—Ä–∞–º–º–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –¥–µ–ª–∏—Ç –Ω–∞ 100
- –ó–∞—Ç–µ–º –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ñ–æ—Ä–º—É–ª—ã –∏–∑ `price_formulas.json`

### Rate Limiting:
- Dewu API: 0.5 req/sec (2 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏)
- –í—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è ~1,500 —Ç–æ–≤–∞—Ä–æ–≤: ~50-60 –º–∏–Ω—É—Ç

### –†–∞–∑–º–µ—Ä—ã –æ–±—É–≤–∏:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –ú/–ñ
- –î–æ 39: –∂–µ–Ω—Å–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (parent_id=102)
- –û—Ç 39.5: –º—É–∂—Å–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (parent_id=101)
- –û–±–∞: —É–Ω–∏—Å–µ–∫—Å (–≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –û—Ç—á–µ—Ç—ã:
- `–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø_–û–®–ò–ë–ö–ê_–§–ï–ù–ò.md` - –û–ø–∏—Å–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏ —Å —Ü–µ–Ω–∞–º–∏
- `–§–ò–ù–ê–õ–¨–ù–ê–Ø_–ü–†–û–í–ï–†–ö–ê_–ö–û–ú–ê–ù–î.md` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã

### –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞:
```bash
poetry run python plummy.py
>>> help <–∫–æ–º–∞–Ω–¥–∞>  # –î–µ—Ç–∞–ª—å–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–µ
```

---

## ‚ö†Ô∏è –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:

**–ü–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º update-prices-full –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:**

```bash
poetry run python plummy.py
>>> update-db
```

**–ü–æ—á–µ–º—É?** –ü–æ–ª–µ `sku_id` –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –Ω–µ–¥–∞–≤–Ω–æ. –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤ –ë–î –∏–º–µ—é—Ç `sku_id = NULL`. –ö–æ–º–∞–Ω–¥–∞ `update-prices-full` —Ç—Ä–µ–±—É–µ—Ç `sku_id` –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.

**–ß—Ç–æ —Å–¥–µ–ª–∞–µ—Ç update-db:**
- –û–±–Ω–æ–≤–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ Dewu API
- –ó–∞–ø–æ–ª–Ω–∏—Ç `sku_id` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞
- –ü–µ—Ä–µ—Å—á–∏—Ç–∞–µ—Ç —Ü–µ–Ω—ã –ø–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã–º —Ñ–æ—Ä–º—É–ª–∞–º

**–í—Ä–µ–º—è:** ~50-60 –º–∏–Ω—É—Ç (~1,500 —Ç–æ–≤–∞—Ä–æ–≤)

### –ü–æ—Å–ª–µ update-db:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –Ω–∞ —Å–∞–π—Ç–µ**
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å update-prices-full –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω**
3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env`
2. API –∫–ª—é—á Dewu (–∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å)
3. –î–æ—Å—Ç—É–ø –∫ WooCommerce API
4. –õ–æ–≥–∏ –∫–æ–º–∞–Ω–¥ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è)

---

**–í–µ—Ä—Å–∏—è:** 2.0  
**–î–∞—Ç–∞:** 18 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

